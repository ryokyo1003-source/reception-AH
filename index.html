<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>上桂動物病院 受付フォーム</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* 全体のスタイル */
    body {
      font-family: 'Noto Sans JP', sans-serif;
      background-color: #f4f7f6;
      color: #333;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      box-sizing: border-box;
    }

    /* フォームコンテナ */
    .container {
      background-color: #ffffff;
      padding: 30px 40px;
      border-radius: 12px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 600px;
    }

    h1 {
      text-align: center;
      font-size: 1.8rem;
      margin-bottom: 30px;
      color: #005a9c; /* 落ち着いた青色 */
    }

    /* 各セクション */
    .section {
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 1px solid #e0e0e0;
    }
    .section:last-of-type {
      border-bottom: none;
      padding-bottom: 0;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      font-size: 1rem;
    }

    /* テキスト入力欄 */
    input[type="text"] {
      width: 100%;
      font-size: 1rem;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    input[type="text"]:focus {
      outline: none;
      border-color: #007bff;
      box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2);
    }

    /* 補足説明のテキスト */
    .note {
      font-size: 0.85rem;
      color: #666;
      font-weight: normal;
      display: inline-block;
      margin-left: 8px;
    }

    /* ボタングループ */
    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }

    .button-group button {
      padding: 10px 15px;
      font-size: 0.95rem;
      border: 1px solid #007bff;
      border-radius: 8px;
      background-color: #e9f5ff;
      color: #0056b3;
      cursor: pointer;
      transition: background-color 0.3s, color 0.3s;
    }

    .button-group button.selected {
      background-color: #007bff;
      color: white;
      font-weight: bold;
    }

    /* 送信ボタン */
    #submitBtn {
      display: block;
      width: 100%;
      background: linear-gradient(45deg, #FF8C42, #ff701a);
      color: white;
      border: none;
      padding: 16px;
      font-size: 1.3rem;
      font-weight: bold;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 30px;
      box-shadow: 0 4px 10px rgba(255, 140, 66, 0.4);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    #submitBtn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(255, 140, 66, 0.5);
    }

    /* 受付完了メッセージ */
    #completionMessage {
      text-align: center;
      padding: 15px;
      background-color: #e6ffed;
      color: #006421;
      border: 1px solid #b7e8c9;
      border-radius: 8px;
      margin-top: 20px;
      display: none; /* 初期状態では非表示 */
    }
  </style>
</head>
<body>

<div class="container">
  <h1>上桂動物病院 受付フォーム</h1>

  <div class="section">
    <label for="owner">ご家族様のご名字</label>
    <input type="text" id="owner" placeholder="例）山田">
  </div>

  <div class="section">
    <label for="pet">動物さんのお名前</label>
    <input type="text" id="pet" placeholder="例）ポチ">
  </div>

  <div class="section">
    <label for="id">診察券番号</label>
    <input type="text" id="id" placeholder="例）12345" inputmode="numeric">
    <div class="button-group" id="idButtons">
      <button data-id="不明">診察券番号が不明</button>
      <button data-id="初診">初診でまだ番号が無い</button>
    </div>
  </div>

  <div class="section">
    <label>ご予約時間帯</label>
    <div class="button-group" id="timeButtons">
      </div>
    <div class="button-group">
      <button data-time="予約なし">予約なし</button>
    </div>
  </div>

  <div class="section">
    <label>保険証 <span class="note">お持ちの場合は保険証入れへ</span></label>
    <div class="button-group" id="insuranceButtons">
      <button data-insurance="あり">保険証あり</button>
      <button data-insurance="なし" class="selected">保険証なし</button>
    </div>
  </div>

  <button id="submitBtn">受付する</button>
  <div id="completionMessage">受付が完了しました！</div>
</div>

<script>
  // --- 初期設定 ---
  const timeButtonsDiv = document.getElementById("timeButtons");
  const idInput = document.getElementById("id");

  // --- 予約時間帯の自動生成 ---
  const now = new Date();
  const nowHour = now.getHours();
  const timeRanges = [];

  // 午前診察時間 (9:00 - 12:00)
  if (nowHour < 14) { // 14時前なら午前の選択肢を表示
    for (let h = 9; h <= 11; h++) {
      timeRanges.push(`${h}:00~${h}:30`, `${h}:30~${h + 1}:00`);
    }
  } 
  // 午後診察時間 (16:30 - 19:00)
  else {
    timeRanges.push("16:30~17:00", "17:00~17:30", "17:30~18:00", "18:00~18:30", "18:30~19:00");
  }

  timeRanges.forEach(t => {
    const btn = document.createElement("button");
    btn.textContent = t;
    btn.dataset.time = t;
    timeButtonsDiv.appendChild(btn);
  });
  
  // --- イベントリスナー設定 ---
  // 汎用ボタングループの選択制御
  document.querySelectorAll('.button-group').forEach(group => {
    group.addEventListener('click', (e) => {
      if (e.target.tagName === 'BUTTON') {
        // 同じグループ内の他のボタンの選択を解除
        group.querySelectorAll('button').forEach(b => b.classList.remove('selected'));
        // クリックされたボタンを選択状態にする
        e.target.classList.add('selected');
        
        // 診察券番号ボタンが押されたら入力欄をクリア
        if (group.id === 'idButtons') {
          idInput.value = '';
        }
      }
    });
  });
  
  // 診察券番号が手入力されたら、ボタンの選択を解除
  idInput.addEventListener('input', () => {
    document.querySelectorAll('#idButtons button').forEach(b => b.classList.remove('selected'));
  });

  // --- 受付送信処理 ---
  document.getElementById("submitBtn").addEventListener("click", () => {
    const owner = document.getElementById("owner").value;
    const pet = document.getElementById("pet").value;
    // 手入力優先、なければ選択されたボタンの値を取得
    const id = idInput.value || document.querySelector("#idButtons .selected")?.dataset.id || "";
    // 時間帯は予約あり・なしを含めて選択されたものを取得
    const time = document.querySelector(".section:has(#timeButtons) .selected")?.dataset.time || "";
    const insurance = document.querySelector("#insuranceButtons .selected")?.dataset.insurance || "";
    const completionMessage = document.getElementById('completionMessage');

    if (!owner || !pet || !time) {
      alert("ご名字、動物さんのお名前、ご予約時間帯は必ず選択してください。");
      return;
    }

    const entry = {
      timestamp: new Date().toLocaleString('ja-JP'),
      owner, pet, id, time, insurance
    };

    // localStorageに保存
    const data = JSON.parse(localStorage.getItem("receptionList") || "[]");
    data.push(entry);
    localStorage.setItem("receptionList", JSON.stringify(data));

    // 受付完了メッセージを表示
    completionMessage.style.display = 'block';

    // フォームをリセット
    document.querySelectorAll("input").forEach(i => i.value = "");
    document.querySelectorAll(".button-group button.selected").forEach(b => b.classList.remove("selected"));
    // 「保険証なし」をデフォルト選択に戻す
    document.querySelector('[data-insurance="なし"]').classList.add('selected');
    
    // 3秒後にメッセージを非表示にする
    setTimeout(() => {
        completionMessage.style.display = 'none';
    }, 3000);
  });
</script>

</body>
</html>
