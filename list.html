<!-- list.html 拡張版 -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>受付一覧と問診</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 1rem;
    }
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 0.5rem;
    }
    .monshin-button {
      padding: 0.3rem 0.6rem;
      font-size: 0.9rem;
    }
    .monshin-output {
      white-space: pre-wrap;
      background: #f9f9f9;
      padding: 0.5rem;
      margin-top: 0.5rem;
      border: 1px solid #ddd;
    }
  </style>
</head>
<body>
  <h1>受付一覧</h1>
  <table id="receptionTable">
    <thead>
      <tr><th>受付時間</th><th>飼い主名</th><th>動物名</th><th>問診</th></tr>
    </thead>
    <tbody>
      <!-- JSで行を追加 -->
    </tbody>
  </table>

  <script>
    // 仮の受付データ
    const receptionData = [
      { rid: '20240906-0930', owner: '山田', pet: 'ポチ', time: '9:30' },
      { rid: '20240906-0945', owner: '佐藤', pet: 'ミケ', time: '9:45' }
    ];

    const tbody = document.querySelector('#receptionTable tbody');
    receptionData.forEach((item) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${item.time}</td>
        <td>${item.owner}</td>
        <td>${item.pet}</td>
        <td>
          <button class="monshin-button" onclick="loadMonshin('${item.rid}', this)">問診を表示</button>
          <div class="monshin-output" id="out-${item.rid}" style="display:none"></div>
        </td>
      `;
      tbody.appendChild(tr);
    });

    async function loadMonshin(rid, btn) {
      const target = document.getElementById(`out-${rid}`);
      if (target.style.display === 'block') {
        target.style.display = 'none';
        btn.textContent = '問診を表示';
        return;
      }
      try {
        const res = await fetch(`data/${rid}.json`);
        if (!res.ok) throw new Error('No data');
        const data = await res.json();
        const lines = Object.entries(data).map(([k, v]) => {
          if (Array.isArray(v)) return `【${k}】\n - ${v.join('\n - ')}`;
          return `【${k}】${v}`;
        });
        target.textContent = lines.join('\n\n');
        target.style.display = 'block';
        btn.textContent = '問診を隠す';
      } catch (e) {
        target.textContent = '問診が未入力、またはデータが見つかりません';
        target.style.display = 'block';
      }
    }
  </script>
</body>
</html>
